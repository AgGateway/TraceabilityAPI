title AgGateway Traceability - Planting Operations

actor Farmer
participant MobileApp
control Tractor Display
control CAN
control planter
control planter Box
participant arable field
database DataPlatform

== field selection ==
Farmer->MobileApp: retrieve my fields
MobileApp ->DataPlatform: GET /geospatial-list
DataPlatform -->MobileApp:geospatial-list
Farmer->MobileApp: select this field
MobileApp ->DataPlatform: GET /geospatial/{id}
DataPlatform -->MobileApp: geospatial

== shipped products ==
Farmer ->MobileApp: scan QR on delivery document
MobileApp ->DataPlatform: GET /shipped-item-instance-list?shipmentId
DataPlatform -->MobileApp: shipped-item-instance-list

== as-filled ==
Farmer->MobileApp: Start Fill Operation
MobileApp ->Tractor Display: Start Fill Operation
Tractor Display -> CAN: attached device
CAN ->planter: attached device
Tractor Display --> MobileApp: container-list
MobileApp ->DataPlatform: POST /critical-tracking-event
DataPlatform -->MobileApp: cteId
note right of DataPlatform: CTE start date time

loop for-each container (planter Box, fertilizer)
Farmer ->MobileApp: identify container
Farmer ->MobileApp: record start volume pct
Farmer ->planter Box: fill container
Farmer ->MobileApp: select product from list
MobileApp ->Tractor Display: select product from list
MobileApp ->DataPlatform: PATCH /critical-tracking-event/{cteId}/traceable-resource-unit
DataPlatform -->MobileApp: truId
end

MobileApp ->DataPlatform: PATCH /critical-tracking-event/{cteId}
note right of DataPlatform: CTE transfer to planter status=complete with end date time
note right of DataPlatform: CTE includes one TRU per container with item instance (qty/lot)

== as-planted ==
